<script>
    document.addEventListener('DOMContentLoaded', async () => {
        const loader = document.getElementById('loader');
        const confirmationArea = document.getElementById('confirmation-area');
        const errorArea = document.getElementById('error-area');
        const sendBtn = document.getElementById('send-to-kitchen-btn');

        const restaurantNumber = '966554242136';

        const urlParams = new URLSearchParams(window.location.search);
        const invoiceId = urlParams.get('id');

        // <<< === THIS IS THE NEW LINE FOR DEBUGGING === >>>
        console.log("Invoice ID from URL:", invoiceId); 
        // <<< =========================================== >>>

        if (!invoiceId) {
            loader.style.display = 'none';
            errorArea.style.display = 'block';
            return;
        }

        try {
            const response = await fetch('/api/confirm-order', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ id: invoiceId })
            });

            const data = await response.json();

            if (response.ok && data.status === 'success') {
                const whatsappUrl = `https://api.whatsapp.com/send?phone=${restaurantNumber}&text=${encodeURIComponent(data.message)}`;
                sendBtn.href = whatsappUrl;
                loader.style.display = 'none';
                confirmationArea.style.display = 'block';
            } else {
                throw new Error(data.message || 'Confirmation failed');
            }

        } catch (error) {
            console.error('Error:', error);
            loader.style.display = 'none';
            errorArea.style.display = 'block';
        }
    });
</script>
